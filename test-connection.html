<!DOCTYPE html>
<html>
<head>
    <title>Connection Test</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        button { padding: 15px 30px; font-size: 18px; cursor: pointer; background: #4F46E5; color: white; border: none; border-radius: 8px; }
        pre { background: white; padding: 20px; border-radius: 8px; margin-top: 20px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üîå Direct Connection Test</h1>
    <p>Testing: http://localhost:5001/api/auth/login</p>
    <button onclick="testConnection()">Test Login Connection</button>
    <pre id="result">Click button to test...</pre>

    <script>
        async function testConnection() {
            const result = document.getElementById('result');
            result.textContent = '‚è≥ Testing connection...\n\n';
            
            const apiUrl = 'http://localhost:5001/api/auth/login';
            
            result.textContent += `Step 1: Attempting to connect to: ${apiUrl}\n`;
            
            try {
                result.textContent += 'Step 2: Sending POST request...\n';
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'Sohang',
                        password: 'Sohang@1911'
                    })
                });
                
                result.textContent += `Step 3: Response received!\n`;
                result.textContent += `   Status: ${response.status}\n`;
                result.textContent += `   OK: ${response.ok}\n\n`;
                
                const data = await response.json();
                
                if (data.success) {
                    result.innerHTML += `<span class="success">‚úÖ CONNECTION SUCCESSFUL!</span>\n\n`;
                    result.textContent += `Username: ${data.user.username}\n`;
                    result.textContent += `Email: ${data.user.email}\n`;
                    result.textContent += `Token: ${data.token.substring(0, 50)}...\n\n`;
                    result.innerHTML += '<span class="success">Backend is reachable from browser!</span>';
                } else {
                    result.innerHTML += `<span class="error">‚ùå Login failed but connection works</span>\n`;
                    result.textContent += JSON.stringify(data, null, 2);
                }
                
            } catch (error) {
                result.innerHTML += `<span class="error">‚ùå CONNECTION FAILED!</span>\n\n`;
                result.textContent += `Error: ${error.message}\n`;
                result.textContent += `Error type: ${error.name}\n\n`;
                
                if (error.message.includes('Failed to fetch')) {
                    result.textContent += 'üîç Possible causes:\n';
                    result.textContent += '1. Backend not running on port 5001\n';
                    result.textContent += '2. CORS blocking the request\n';
                    result.textContent += '3. Firewall blocking localhost:5001\n';
                    result.textContent += '4. Browser blocking mixed content\n';
                }
            }
        }
    </script>
</body>
</html>
